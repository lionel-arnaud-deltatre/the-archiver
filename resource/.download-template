# WARNING - DO NOT MODIFY THIS ACTION
# THIS FILE IS GENERATED BY THE ARCHIVER TOOL AFER DEPLOYING THE APP
#

name: Download artifact <device_type> - <env>

on:
  workflow_dispatch:
    inputs:
      version:
        description: 'Select version to rollback'
        required: true
        type: choice
        options:
          <versions_placeholder>

jobs:
  rollback:
    runs-on: ubuntu-latest
    steps:

      - name: "Fetch archive (version ${{ github.event.inputs.version }}) and store it"
        id: fetcharchive
        uses: lionel-arnaud-deltatre/the-archiver@main
        with:
          actionType: "fetch-archive"
          version: ${{ github.event.inputs.version }}
          appName: <project_name>
          deviceType: <device_type>
          environment: <env>
        env:          
          ARCHIVER_AWS_ACCESS_KEY_ID: ${{ secrets.ARCHIVER_AWS_ACCESS_KEY_ID }}
          ARCHIVER_AWS_SECRET_ACCESS_KEY: ${{ secrets.ARCHIVER_AWS_SECRET_ACCESS_KEY }}
          ARCHIVER_BUCKET_NAME: ${{ vars.ARCHIVER_BUCKET_NAME }}
          ARCHIVER_S3_REGION: ${{ vars.ARCHIVER_S3_REGION }}
          ARCHIVER_ROOT_FOLDER: ${{ vars.ARCHIVER_ROOT_FOLDER }}          

      - name: Verify file existence and set corrected path
        run: |
          ARCHIVE_PATH="${{ steps.fetcharchive.outputs.archivePath }}"
          CORRECTED_PATH="${GITHUB_WORKSPACE}${ARCHIVE_PATH#/github/workspace}"
          echo "CORRECTED_PATH=$CORRECTED_PATH" >> $GITHUB_ENV
          if [ -f "$CORRECTED_PATH" ]; then
            echo "File exists at corrected path."
          else
            echo "File does not exist at corrected path."
            exit 1
          fi

      - name: Upload artifact in Github 
        uses: actions/upload-artifact@v4
        with:
          name: ${{ steps.fetcharchive.outputs.archiveName }}
          path: "${{ env.CORRECTED_PATH }}"
          retention-days: 1
